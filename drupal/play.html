<!doctype html>
<html>
<head>
<script>

// Fetch the angle between two points (x1, y1, x2, y2) or between (0, 0 and x1, y1)
function a(x1, y1) {
  if ((typeof(arguments[2]) !== 'undefined') && (typeof(arguments[3]) !== 'undefined')) {
    return Math.atan2(x1-arguments[2], y1-arguments[3]);
  }
  return Math.atan2(0-x1, 0-y1);
}

// Convert radians to direction.
function dir(n) {
  if      ((n >= -0.39269908169872414) && (n <  0.39269908169872414)) return 'n';
  else if ((n >=  0.39269908169872414) && (n <  1.17809724509617240)) return 'nw';
  else if ((n >=  1.17809724509617240) && (n <  1.96349540849362070)) return 'w';
  else if ((n >=  1.96349540849362070) && (n <  2.74889357189106900)) return 'sw';
  else if (n >=  2.74889357189106900) return 's';
  else if ((n <  -0.39269908169872414) && (n >= -1.1780972450961724)) return 'ne';
  else if ((n <  -1.17809724509617240) && (n >= -1.9634954084936207)) return 'e';
  else if ((n <  -1.96349540849362070) && (n >= -2.7488935718910690)) return 'se';
  else if (n <   2.74889357189106900) return 's';
  else return 's'; // if the math of a() is correct this shouldn't happen.
}

// Rotate n by a degrees, keeping values clamped between -Math.PI <= 0 <= Math.PI
function radrot(n, a) {
  return (n + a) % Math.PI;
}

console.log(dir(a(-4,-4)) + '    ' + dir(a(0,-4)) + '    ' + dir(a(4,-4)));
console.log(dir(a(-4, 0)) + '         ' + dir(a(4, 0)));
console.log(dir(a(-4, 4)) + '    ' + dir(a(0, 4)) + '    ' + dir(a(4, 4)));

/* output:
    nw    n    ne
    w         e
    sw    s    se
*/
console.log('');
console.log(dir(radrot(a(-4,-4), -0.5)) + '    ' + dir(radrot(a(0,-4), -0.5)) + '    ' + dir(radrot(a(4,-4), -0.5)));
console.log(dir(radrot(a(-4, 0), -0.5)) + '         ' + dir(radrot(a(4, 0), -0.5)));
console.log(dir(radrot(a(-4, 4), -0.5)) + '    ' + dir(radrot(a(0, 4), -0.5)) + '    ' + dir(radrot(a(4, 4), -0.5)));

/* output:
    n    ne    e
    nw         se
    w    sw    s
*/

var Bot = {

  stateChange: function(world, enemies, obstacles) {
    if (obstacles.length) {
      return 'move'; // RUN!!!
    }
    else if (enemies.length) {
      return 'fire+move'; // CHARGE!!!
    }
    else {
      return this.state;
    }
  },

  move: function(world, enemies, obstacles) {
    if (obstacles.length) {
      return dir(radrot(a(this.x, this.y, obstacles[0].x, obstacles[0].y), Math.PI/2)); // Run away.
    }
    else if (enemies.length) {
      return dir(a(this.x, this.y, enemies[0].x, enemies[0].y)); // Run towards.
    }
    else {
      return 'nw'; // Explore.
    }
  },

  aim: function(world, weapon, enemies, obstacles) {
    if (enemies.length) {
      return a(enemies[0].x, enemies[0].y); // Pew pew pew!
    }
    else {
      return 0; // Nothing to aim at.
    }
  }

};

</script>
</head>
<body></body>
</html>
